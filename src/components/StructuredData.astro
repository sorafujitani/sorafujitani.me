---
export interface Props {
  type: 'Article' | 'WebSite' | 'BreadcrumbList';
  // Article
  title?: string;
  description?: string;
  publishedDate?: Date;
  updatedDate?: Date;
  author?: string;
  image?: string;
  url?: string;
  // BreadcrumbList
  breadcrumbs?: { name: string; url: string }[];
}

import { SITE_URL, SITE_NAME } from '@lib/constants';

const { type, title, description, publishedDate, updatedDate, author, image, url, breadcrumbs } = Astro.props;
const siteUrl = Astro.site?.toString() || SITE_URL;

function generateArticleSchema() {
  return {
    '@context': 'https://schema.org',
    '@type': 'Article',
    headline: title,
    description: description,
    image: image ? new URL(image, siteUrl).toString() : undefined,
    datePublished: publishedDate?.toISOString(),
    dateModified: (updatedDate || publishedDate)?.toISOString(),
    author: {
      '@type': 'Person',
      name: author || SITE_NAME,
      url: siteUrl,
    },
    publisher: {
      '@type': 'Person',
      name: SITE_NAME,
      url: siteUrl,
    },
    mainEntityOfPage: {
      '@type': 'WebPage',
      '@id': url,
    },
  };
}

function generateWebSiteSchema() {
  return {
    '@context': 'https://schema.org',
    '@type': 'WebSite',
    name: SITE_NAME,
    url: siteUrl,
    author: {
      '@type': 'Person',
      name: SITE_NAME,
    },
  };
}

function generateBreadcrumbSchema() {
  if (!breadcrumbs || breadcrumbs.length === 0) return null;
  return {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: breadcrumbs.map((item, index) => ({
      '@type': 'ListItem',
      position: index + 1,
      name: item.name,
      item: new URL(item.url, siteUrl).toString(),
    })),
  };
}

let schema: object | null = null;
switch (type) {
  case 'Article':
    schema = generateArticleSchema();
    break;
  case 'WebSite':
    schema = generateWebSiteSchema();
    break;
  case 'BreadcrumbList':
    schema = generateBreadcrumbSchema();
    break;
}
---

{schema && (
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
)}
